
---

East-West 와 반대되는 개념으로 **North-South 트래픽이** 있다

> [!info] 이는 수직으로 흐르는 트래픽을 생각하면되며, IGW 를 통과하는 트래픽이 그 예시이다

![[엣지에 연결된 라우팅 테이블.png]]

1. **인터넷 서버인 13.246.100.25 가 13.124.5.233 인스턴스로 트래픽을 보낸다**
2. IGW 에서 매핑되어있는 **NAT Table 을 통해 EIP(13.124.5.233) 을 Private IP(92.75.20.100) 으로 변환**한다. 
3. **IGW 에 연결된 게이트웨이 라우팅 테이블(Edge Association)에서, 92.75.20.0/24 범위의 트래픽은 eni-1* 으로 보내며,** 이는 eni-1* 에 연결된 **92.75.100.128 IP 를 가진 인스턴스가 받아 처리한다.**
4. 92.75.100.128 IP 를 가진 인스턴스는 **Source/Dest 확인이 해제**되어 있으므로, **해당 트래픽을 목적지인 92.75.20.100 으로 트래픽을 포워딩한다.**
5. **트래픽을 수신한 92.75.20.100 인스턴스는 13.246.100.25 에 응답회신을 위해 라우팅 테이블의 규칙에 따라 eni-1* 로 트래픽을 보낸다** 
6. eni-1* 에 연결된 인스턴스는 반환 트래픽의 목적지(13.246.100.25/32)로 트래픽을 보내기 위해 **라우팅 테이블의 Target 인 IGW-* 으로 트래픽을 포워딩**한다.
	**여기서 중요한건 eni-1* 에 연결된 인스턴스는 soruce/dest 확인체크가 해제되어 있기에, 받은 트레픽의 dest 가 자신의 IP 인 92.75.100.128 과 달라도 트래픽을 수용한다.**
7. **IGW 에서는 받은 트래픽의 Private IP 를 Public IP(EIP) 로 변환후 목적지로 트래픽을 전송한다**


책에서는 **Edge Routing** 에 대한 부분만 따로 설명하고자 한다.
책을 좀더 살펴보며 내용을 그리고, 살펴보자.

![[게이트웨이 라우팅 테이블을 경유하는 인바운드 트래픽.png]]

>[!info] 여기서 말하는 **Edge** 는  **IGW 와 Virtual Private Gateway, VGW** 를 통틀어서 지칭하는 용어이다

1. **IGW 와 VGW 엣지의 패런트는 리전이며, 연결 대상은 VPC 이다.**
	그러므로 엣지는 VPC 에 연결되어 VPC 내부와 외부 사이의 트래픽을 중계한다
	
2. **Routing Table 을 엣지(IGW, VGW) 에 연결한것을 Edge 연결(Edge association)이라 한다**
	엣지 연결은 선택적이라 한다
	
3. **엣지 연결 상태의 라우팅 테이블**을 **게이트웨이 라우팅 테이블**이라 한다

4. 게이트웨이 라우팅 테이블은 VPC 인바운드 트래픽만 관여한다. 그래서 **내부 라우팅(Ingress Routing)** 이라 부르기도 한다

5. **라우팅 대상도 VPC CIDR 로 한정해야 하고, 라우팅 대상의 합도 VPC CIDR 이어야 한다**

	이는 엣지로 유입되는 트래픽을 서브넷 곳곳에 빈틈없이 전달할수 있다.
6. **라우팅 타깃도 VPC 내부 리소스라 추측할수 있다. 서브넷 라우팅은 그 대상을 VPC CIDR 로 한정하지 않으므로, VPC CIDR 로 한정한 엣지용 라우팅 테이블은 서브넷 라우팅 테이블과 구분해서 사용해야 한다.**

7. 게이트웨이 라우팅 테이블은 대상과 타깃은 다음 조건을 따른다
	- **라우팅 대상:** 대상이 VPC CIDR 인 라우팅은 삭제할수 없으며, VPC CIDR 외 다른 라우팅을 새로 추가하려면 VPC 내부의 서브넷 단위로만 지정할수 있다.
	
	![[엣지연결이 가능한 라우팅 테이블 예.png]]

	- **라우팅 타깃**: Target 은 3종류만 가능하다
		1. **ENI 또는 Instance**
			 인스턴스를 타깃으로 지정하면 인스턴스가 소유한 ENI 로 변경 적용된다. ENI 가 2개이상 소유한 인스턴스는 특정 ENI 를 타깃으로 지정해야 하며, 그렇지 않으면 오류가 발생한다
		2. **게이트웨이 로드밸런서 엔드포인트**
		3. **Local**


여기서 IGW 의 게이트웨이 라우팅 테이블은 다음과 같은 특징을 볼수 있다.

- 연결된 게이트웨이 라우팅 테이블이 없더라도, 엣지는 자신에게 유입된 트래픽을 VPC CIDR 로 전달한다.<br>이는 기본 로컬 라우팅만 저장된 게이트웨이 라우팅 테이블을 엣지에 연결한것과 같다<br>그래서 묵시적으로 게이트웨이 라우팅 테이블에 기본 로컬 라우팅이 저장되어있다고 볼수도 있다

 **기본 로컬 라우팅만 저장된 게이트웨이 라우팅 테이블**

| Destination  | Target |
| :----------- | :----- |
| 92.75.0.0/16 | Local  |

- 퍼블릭 서브넷의 인스턴스는 퍼블릭 IP 가 할당돼 있지 않고 오히려 Private Subnet 인스턴스에는 탄력적 IP 가 연결되어 있다 