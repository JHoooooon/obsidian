
---

> [!info] [[온프레미스의 SLB 제어 - L4 스위치]] 에서 `SLB` 에 대한 개념을 볼 수 있다

![[온프레미스의 SLB.png]]

- `L4 스위치` 내부에 다수 가상 서버를 생성할 수 있다.<br>가상서버 `13.246.100.25:80` 1개만 생성되었지만 여러개 생성 가능하다 .

- `L4 스위치` 를 경계로 외부망과 내부망을 분리할 수 있다.<br> 이는 보안과 직결되며, `L4 스위치` 만 `Public IP` 를 할당하고  리얼 서버는 `Private IP` 만 할당해 서비스한다.<br><br>이 구성으로 인해 `L4 스위치` 를 통과하지 않으면 `real server` 에 접근이 불가하다.<br>`L4 스위치` 가 `13.246.100.25` 인 `Public IP` 를 통해 내부 `real server` 와 통신하는것을 볼 수 있다.

- `Virtual server` 가 트래픽을 분산하는 `Real Server` 의 모음을 `대상그룹`(`Target Group`) 이라 한다. 토폴로지상에서는 `1개의 대상그룹` 에 `2개의 Real Server` 가 있는 모습이다.

- `Virtual PORT` 와 `Real PORT` 가 서로 달라도 상관없다. 토폴로지상 에서는 두 `PORT` 가 서로 일치하지만, 다르게 설정하는게 보안상에 더 유리하다

- `Virtual Server` 가 `Target Group` 안의 `Real Server` 로 트래픽을 분산하는 방식은 매우 다양하다<br><br>대상 그룹마다 분산 방식을 선택할수 있다 이에 대해서는 총 3가지의 방식이 존재한다<br><br>1. **라운드 로빈(Round Robin)**: `Target Group` 에 포함된 `Real SErver` 에 순차적으로 분산하는 방식<br><br>2. **IP 해시(IP Hash)**: `Client IP` 주소를 `Hash 함수` 의 변수로 활용하고, 고정된 `Real Server` 로 분산하는 방식<br><br>3. **Least Connection(최소연결)**: `Client` 의 신규 요청 시점을 `Real Server` 별 기존 연결(`Balancing`) `수를 분석해 그 수가 가장 적은 서버(부하가 덜한 서버)로 분산하는 방식`

다음은 위의 특징을 고려해서 만든 내용이다.

![[L4 스위치 SLB 예.png]]

`L4 S/W` 에는 2개의 가상서버가 연결되어 있으며, 가상서버는 각기 다른 `Targe Group` 에 연결되어 있다.

`Virtual Server` 상의 `Virtual Port` 와 `Target Group` 상의 `Real Server` 의 `Real Port` 가 서로 다르게 설정되어 있으며, `Real Server 2` 는 각기 다른 `Target Group` 에 중복되서 사용된것을 볼 수 있다. 

트래픽 분산 경로는 다음과 같이 표현된다

| 사용자 요청 | Virtual Server IP | Virtual Port | 요청 전달 | Target Group | Real Server IP | Real Port |
| :----- | :---------------- | :----------- | :---- | ------------ | -------------- | --------- |
| ->     | 13.246.100.25     | 80           | ->    | 1            | 92.75.100.82   | 30080     |
| ->     | 13.246.100.25     | 80           | ->    | 1            | 92.75.100.41   | 30080     |
| ->     | 13.246.100.174    | 6800         | ->    | 2            | 92.75.100.41   | 18600     |
| ->     | 13.246.100.174    | 6800         | ->    | 2            | 92.75.100.141  | 18600     |
