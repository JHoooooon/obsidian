
---

인스턴스의 접속 대상 IP 가 인터넷과 VPC 에 공존하는 상황을 가정해보자.

![[중첩된 CIDR.png]]

현재 **92.75.100.0/24 의 라우팅 테이블**을 보면 다음과 같다

| Dest             | Target |
| :--------------- | :----- |
| 97.75.0.0/16     | Local  |
| 13.246.100.0/24  | IGW-*  |
| 13.246.100.25/32 | PCX-*  |

Local 을 제외한 첫번째 트래픽의 목적지 13.246.100.0/24 에 속하면 IGW-* 으로 라우팅된다.
Local 을 제외한 두번째 트래픽의 목적지 13.246.100.25/32 에 속하면 PCX-* 으로 라우팅된다.

**PCX-* 은 Peering Connection 된 VPX 로 안내되는 라우팅이다.**

여기서 중요하게 볼 상황은 13.246.100.0/24 와 13.246.100.25/32 는 중복된다.
13.246.100.25/32 는 13.246.100.0/24 에 속하는 IP 이므로, 두 IP 는 중복된다

이때, 어떠한 곳으로 라우팅 되어야 하는지 라우팅 테이블은 선택해야 한다.
이러한 프로세스는 다음과 같다

![[Routing Longest Prefix Match 기법.png]]

1. 92.75.0.0/16 등록 요청시 기존의 모든 라우팅 대상과 일치여부를 검사한다. 
	**Destination 은 같은데 Target 이 다르면 방향 안내가 불가하므로 요청시점에서 거부한다** 즉, **대상이 일치하지 않을때만 등록한다**
2. 13.246.100.0/24 등록 요청시 1번을 수행하고 라우팅 Destination 이 다르므로 저장 조건이 충족된다. 
	**기존 92.75.0.0/16 이 있으므로, 서브넷 마스크를 비교하여 내림차순(24 -> 16)으로 정렬한다**
3. 13.246.100.25/32 등록을 오청하면 1번을 수행한다
	대상이 불일치 하므로 저장조건을 충족한다.
	**테이블에 정렬된 기존 라우팅 13.246.100.0/24 가 있으므로, 서브넷 마스크를 비교해서 내림차순(32 -> 24 -> 16) 으로 정렬한다**

**이러한 정렬 기준으로, 13.246.100.25 가 대상인 트래픽은 PCX-* 으로 라우팅된다.**

이러한 **정렬방법을 Longest Prefix Match 라 하며, 가장 긴 서브넷 마스크 비트순으로 라우팅을 정렬, 비교해 트래픽을 안내**하는것이다

