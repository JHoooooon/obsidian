
`background` ë™ê¸°í™”ì˜ ë³¸ì§ˆì€ `page context` ì—ì„œ ì´ë£¨ì–´ì§€ëŠ” ì‘ì—…ì„ `background` ë¡œ ì˜®ê¸°ëŠ”ê²ƒì´ë‹¤.

`background` ì—ì„œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ë©´, ì‰½ê²Œ íœ˜ë°œë˜ëŠ” `webpage` ì˜ íŠ¹ì„±ì—ì„œ ë²—ì–´ë‚ ìˆ˜ ìˆë‹¤.
>[!info] `server` ê°€ `down` ë˜ì—ˆê±°ë‚˜, `webpage` ëŠ” ì–¸ì œë“  ë‹«íìˆ˜ ìˆë‹¤.

ì´ëŸ¬í•œ í™˜ê²½ì—ì„œ ì‚¬ìš©ì ê¸°ê¸°ì— `brower` ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” í•œ `background sync` ëŠ” ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë ë•Œê¹Œì§€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ”ë‹¤.

ì´ëŠ” `page` ê°€ ë‹«í˜€ë„, ê³„ì† ì§„í–‰ë˜ì–´ì•¼ í•˜ëŠ” ì‘ì—…ì„ `background` ì— ë™ê¸°í™”ì‚¬ìš©í• ìˆ˜ ìˆë„ë¡ ì œê³µí•œë‹¤.

>[!info] ìº˜ë¦°ë”ì— ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜, í•´ì•¼í• ì¼ ëª©ë¡ ì¤‘ í•˜ë‚˜ë¥¼ ì™„ë£Œ í‘œì‹œí•˜ëŠ” ì‘ì—…ë“¤ì˜ ì™„ë£Œë¥¼ ë³´ì¥í•œë‹¤.

ì´ëŸ¬í•œ ë°©ì‹ì€ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„ëœë‹¤.
ì´ëŠ” `page` ì—ì„œ `Ajax`  í˜¸ì¶œê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ëŒ€ì‹  ë™ê¸°í™” ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ë©´ ëœë‹¤.

```js
navigator.serviceWorker.ready.then((registration) => {
	registration.sync.register("send-messages");
})
```

ì´ëŠ” í™œì„±í™”ëœ `service worker` ì˜ ë“±ë¡ ê°ì²´ë¥¼ ë°›ì•„ì™€ `"send-messages"` ë¼ëŠ” ë™ê¸°í™” ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤. 

ë‹¤ìŒì€, `service worker` ì— `sync` ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•˜ë©°, ì´ë¥¼ í†µí•´ ë™ê¸°í™” ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•œë‹¤.

```js
self.addEventListener("sync", (event) => {
	if (event.tag === "send-message") {
		// resolve ë ë•Œê¹Œì§€ ì‹¤í–‰
		// waitUntil ì€ ì´ë²¤íŠ¸ ì¢…ë£Œë¥¼ ìš”ì²­í•˜ê¸°ì „ê°€ì§€, ì´ë²¤íŠ¸ë¥¼ ìœ ì§€í•´ì¤€ë‹¤.
		event.waitUntil(() => {
			const send = sendMessages();
			if (send) {
				// ì„±ê³µ 
				return Promise.resolve();
			} else {
				// ì‹¤íŒ¨
				// ì‹¤íŒ¨ì‹œ, taskqueue ì— ë“¤ì–´ê°€ ë‹¤ì‹œ ë¹„ë™ê¸°ë¡œì¨ ì‹¤í–‰
				return Promise.reject();
			}
		})
	}	
});
```

## :LiFolderSync: The SyncManager

ë™ê¸°í™” ì´ë²¤íŠ¸ ë“±ë¡ê³¼ ìˆ˜ì‹ ì— ëŒ€í•œ ì½”ë“œë¥¼ ì‚´í´ë³´ì•˜ë‹¤.
ë™ê¸°í™” ì´ë²¤íŠ¸ì™€ ê´€ë ¨ëœ ëª¨ë“  ìƒí˜¸ì‘ìš©ì€ `SyncManager` ë¥¼ í†µí•´ ì´ë£¨ì–´ì§„ë‹¤.

>[!info] [SyncManger API](https://caniuse.com/?search=syncmanager) ê´€ë ¨í•´ì„œ, ì œê³µí•˜ëŠ” `browser` ê°€ ì ë‹¤.<br>ì´ëŠ” íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ì§€ë§Œ, `fallback` í˜•ì‹ì˜ ì½”ë“œë¥¼ êµ¬í˜„í•˜ê¸°ë„ í•´ì•¼ í•œë‹¤.

`SyncManager` ëŠ” ë™ê¸°í™” ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³ , í˜„ì¬ ë“±ë¡ëœ ë™ê¸°í™” ì‘ì—…ì„ ê°€ì ¸ì˜¤ëŠ” ê¸°ëŠ¥ì„ ê²¢ê³µí•˜ëŠ” `service worker` ì˜ `interface` ì´ë‹¤.

### :LiActivity: SyncManager ì ‘ê·¼í•˜ê¸°

í™œì„±í™”ëœ `service worker` ë“±ë¡ ê°ì²´ë¥¼ í†µí•˜ì—¬ `SyncManager` ì— ì ‘ê·¼í• ìˆ˜ ìˆë‹¤.
ë“±ë¡ ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì€ `service worker`  ì—ì„œ ê°€ì ¸ì˜¤ëŠ”ì§€, ì•„ë‹ˆë©´ `page` ì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ëŠ”ì§€ì— ë”°ë¼ ì¡°ê¸ˆì”© ë‹¬ë¼ì§„ë‹¤.

`service worker` ë‚´ì—ì„œëŠ” `global object`  ë¥¼ í†µí•´ ì‰½ê²Œ `service worker`  ì— ì ‘ê·¼ê°€ëŠ¥í•˜ë‹¤

```js
self.registraion;
```

ë°˜ë©´, `page` ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°ì—ëŠ” í˜„ì¬ í™œì„±í™”ëœ `service worker` ê°ì²´ì— ì ‘ê·¼ê°€ëŠ¥í•˜ì§€ í™•ì¸í•˜ê¸° ìœ„í•´, `ready` ë¥¼ í˜¸ì¶œí•˜ì—¬, ì ‘ê·¼í•´ì•¼ í•œë‹¤.

```js
navigatior.serviceWorker.ready.then((registration) =>{...})
```

ì´ë ‡ê²Œ `service worker` ì˜ ë“±ë¡ ê°ì²´ë¥¼ ê°€ì ¸ì™”ë”°ë©´, `SyncManager`  ë¥¼ í†µí•œ ìƒí˜¸ì‘ìš©ì€ `service worker `ì—ì„œ í•˜ë˜ í˜ì´ì§€ì—ì„œ í•˜ë˜ ìƒê´€ì—†ë‹¤.

### Â® Event ë“±ë¡

ë™ê¸°í™” ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ë ¤ë©´ `SyncManager` ì—ì„œ ë“±ë¡í•˜ê³ ì í•˜ëŠ” `ë™ê¸°í™” ì´ë²¤íŠ¸ ì´ë¦„`(`TagName`) ì„ íŒŒë¼ë¯¸í„°ë¡œ `register` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

ë‹¤ìŒì€ `send-messages` ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤.

```js
self.registration.sync.register("send-messages");
```

`service worker` ê°€ ì œì–´í•˜ëŠ” `page` ì—ì„œ ê°™ì€ `event` ë¥¼ ë“±ë¡í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ `code` ë¥¼ ì‚¬ìš©í•œë‹¤.

```js
navigator.serviceWorker.ready.then((registraion) => {
	registration.sync.register("send-messages");
});
```

### :LiSyncSmall: ë™ê¸°í™” ì´ë²¤íŠ¸

ë™ê¸°í™” ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¼ì´ ì¼ì–´ë‚œë‹¤.

1. **`SyncManager`  ëŠ” ê°„ë‹¨í•œ ë™ê¸°í™” ì´ë²¤íŠ¸ íƒœê·¸ ëª©ë¡ì„ ìœ ì§€í•œë‹¤.**<br>êµ¬í˜„ì€ ë˜ì–´ìˆì§€ ì•Šìœ¼ë©°, êµ¬í˜„ì— ëŒ€í•œ ë¡œì§ì€ ì „ì ìœ¼ë¡œ `service worker` ì˜ `sync` ì´ë²¤íŠ¸ `listener` ì˜ `code` ì— ë‹¬ë ¤ìˆë‹¤.

2. **`SyncManager` ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš° `sync` ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.**<br>ğŸ‘‰ ë™ê¸°í™” ì´ë²¤íŠ¸ ë“±ë¡ ì§í›„<br>ğŸ‘‰ ì‚¬ìš©ì ìƒíƒœê°€ `offline` ì—ì„œ `online` ìœ¼ë¡œ ë³€ê²½<br>ğŸ‘‰ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì§€ ì•Šì€ `sync` ì´ë²¤íŠ¸ê°€ ìˆì„ ê²½ìš°, ë§¤ ë¶„ë§ˆë‹¤

3. **`service worker` ëŠ” ë™ê¸°í™” ì´ë²¤íŠ¸ë¥¼ `promise` í˜•ì‹ìœ¼ë¡œ ìˆ˜ì‹ í•˜ê³ , ì²˜ë¦¬í• ìˆ˜ ìˆë‹¤.**<br>ğŸ‘‰ `promise` ê°€ `resolve` ë˜ë©´, `SyncManager` ì—ì„œ í•´ë‹¹ `sync` `event` ê°€ ì‚­ì œëœë‹¤.<br>ğŸ‘‰ `reject` ë˜ë©´,  `SyncManager` ëŠ” ë‹¤ìŒ ë™ê¸°í™” ì‹œì ì— ë‹¤ì‹œ ì‹œë„ë  ìˆ˜ ìˆë„ë¡ `SyncManager` ì— ë‚¨ê¸°ê²Œ ëœë‹¤.

### :LiTag: Event Tag

`Event Tag` ëŠ” ìœ ì¼í•´ì•¼ í•œë‹¤.
`SyncManager`  ì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” `Tag` ëª…ìœ¼ë¡œ `Sync` ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ë©´, `SyncManager` ëŠ” ì´ë¥¼ ë¬´ì‹œí•˜ê³  ì¤‘ë³µìœ¼ë¡œ ì¶”ê°€í•˜ì§€ ì•ŠëŠ”ë‹¤.

`SyncManager` ì˜ ê°€ì¥ ìœ ìš©í•œ íŠ¹ì§•ì¤‘ í•˜ë‚˜ë¡œì¨, ë§ì€ ìˆ˜ì˜ ë¹„ìŠ·í•œ ì‘ì—… (ì´ë©”ì¼ ì „ì†¡ê°™ì€..) ì„ í•˜ë‚˜ì˜ `event` ë¡œ `group` í™” ì‹œì¼œ ì²˜ë¦¬í• ìˆ˜ ìˆë‹¤.

ìƒˆë¡œìš´ ì‘ì—…ì´ ì¶”ê°€ë ë•Œë§ˆë‹¤ `event` ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í˜¹ì€ í˜„ì¬ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ì§€ ì•Šê³ , ëª¨ë“  ì‘ì—… (ì´ë©”ì¼ ë°œì†¡í•¨ì˜ ë©”ì¼ì„ í•œë²ˆì— ì „ì†¡) ì„ ì²˜ë¦¬í•˜ëŠ” ë™ê¸°í™” ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í• ìˆ˜ ìˆë‹¤.

ë‹¤ìŒì€ ì´ë©”ì¼ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ì´ë‹¤.

1. ì‚¬ìš©ìê°€ ì´ë©”ì¼ì„ ë³´ë‚¼ë•Œ ë§ˆë‹¤, `IndexedDB` ì˜ ë³´ë‚¸ í¸ì§€í•¨ì— ì´ë©”ì¼ì„ ì €ì¥í•œë‹¤.
2. ê·¸ì™€ ë™ì‹œì— `send-unsent-message`  ë¥¼ `BackgroundSync` ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  êµ¬í˜„í• ìˆ˜ ìˆë‹¤.
3. `service worker` ìª½ì˜ `event listener` ëŠ” `IndexedDB` ì˜ ë³´ë‚¸í¸ì§€í•¨ì˜ ëª¨ë“  ì´ë©”ì¼ì„ ìˆœíšŒí•˜ë©°, ì´ë©”ì¼ ì „ì†¡ì„ ì‹œë„í•œë‹¤.
4. ë°œì†¡ì— ì„±ê³µí•˜ë©´, í•´ë‹¹ ì´ë©”ì¼ì„ ì‚­ì œí•œë‹¤.
5. ë°œì†¡ì— ì‹¤íŒ¨í•˜ë©´, ì´ ì´ë©”ì¼ì€ `sync` ì´ë²¤íŠ¸ì—ì„œ `reject` ëœë‹¤.
6. `SyncManager`  ëŠ” ì‚¬ìš©ìì˜ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì´ ë°”ë€Œê±°ë‚˜ ì¼ì • ì‹œê°„ì´ ì§€ë‚œ ê²½ìš°, ë‹¤ì‹œ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
7. ë‹¤ì‹œí•œë²ˆ `IndexedDB` ì˜ ë³´ë‚¸ í¸ì§€í•¨ì„ ëŒë©°, ì „ì†¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ê³¼ ê·¸ ì´í›„ì— ìƒˆë¡œ ì‘ì„±í•œ ì´ë©”ì¼ì„ ë‹¤ì‹œ ë°œì†¡í•˜ê³ , ë³´ë‚¸ í¸ì§€í•¨ì„ ë¹„ìš´ë‹¤.
8. ë°˜ë³µí•œë‹¤.

ì´ëŠ” ë³´ë‚¸ í¸ì§€í•¨ì— ì´ë©”ì¼ì´ ìˆëŠ” í•œ, ë™ê¸°í™” ì´ë²¤íŠ¸ëŠ” ë“±ë¡ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©°, ì£¼ê¸°ì ìœ¼ë¡œ í•´ë‹¹ ì´ë©”ì¼ì„ ì „ì†¡í•˜ë ¤ê³  ì‹œë„í•œë‹¤.

ì´ë•Œ, ì¤‘ë³µí•´ì„œ ë“±ë¡ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— `send-unsent-messages` ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ ì•„ë‹ˆë©´. ì‹¤í–‰ì¤‘ì¸ì§€ í™•ì¸í•  í•„ìš”ê°€ ì—†ë‹¤ 

ì´ë²¤íŠ¸ë¥¼ ê°œë³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´, ì´ë²¤íŠ¸ì— `send-message-432` , `send-message-433` ë“±ê³¼ ê°™ì€ ê³ ìœ í•œ ì´ë¦„ì„ ë¶€ì—¬í•˜ë©´ ëœë‹¤.

### ë“±ë¡ëœ ë™ê¸°í™” ì´ë²¤íŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°

`SyncManager` ì˜ `getTags()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´, ì‹¤í–‰ ì˜ˆì •ì¸ ì „ì²´ ë™ê¸°í™” ì´ë²¤íŠ¸ ëª©ë¡ì„ ë°›ì•„ì˜¬ìˆ˜ ìˆë‹¤.

`getTags()` ëŠ” `Promise` ë¥¼ ë°˜í™˜í•˜ë©°, `Promise` ê°€ `resolve` ë˜ë©´ ë™ê¸°í™” ì´ë²¤íŠ¸ íƒœê·¸ ì´ë¦„ì´ ì±„ì›Œì§„ ë°°ì—´ì„ ê°€ì ¸ì˜¬ìˆ˜ ìˆë‹¤.

>[!info] ì„œë¹„ìŠ¤ì›Œì»¤ ë‚´
```js
self.registeration.sync
	.register("hello-sync")
	.then(() => {
		return self.registration.sync.getTags();
	})
	.then((tags) => {
		console.log(tags); // ["hello-sync"]
	});
```

`service worker` ê°€ ì œì–´í•˜ëŠ” `page` ì—ì„œëŠ” `ready` ë¥¼ ì‚¬ìš©í•´ ë“±ë¡ ê°ì²´ë¥¼ ë¨¼ì € ë°›ì•„ì˜¤ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë¹„ìŠ·í•œ ê²°ê³¼ë¥¼ ì–»ì„ìˆ˜ ìˆë‹¤.

>[!info] ì„œë¹„ìŠ¤ì›Œì»¤ê°€ ì œì–´í•˜ëŠ” í˜ì´ì§€
```js
navigator.serviceWorker.ready.then((registration) => {
	registration.sync
	.then(() => {
		return registration.sync.getTags();
	})
	.then((tags) => {
		console.log(tags); // ["send-messages"]
	});
});
```


### lastChance

ê°€ë”ì‹ `SyncManager` ê°€ íŠ¹ì • `sync` ì´ë²¤íŠ¸ê°€ ê³„ì† ì‹¤íŒ¨í•œë‹¤ê³  íŒë‹¨í•˜ê³ , ìì› ë‚­ë¹„ë¥¼ ë§‰ê¸° ìœ„í•´ `event` ë¥¼ ì œê±°í•˜ê¸° ì „ ë§ˆì§€ë§‰ìœ¼ë¡œ í•œ ë²ˆë” `sync` ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ê¸°ë¡œ ê²°ì •í• ìˆ˜ë„ ìˆë‹¤.

ì´ëŸ° ê²½ìš° ì „ë‹¬ëœ `Sync` `event` ì˜ `lastChange` ì†ì„±ì„ í™•ì¸í•´ í•´ë‹¹ ì´ë²¤íŠ¸ê°€ `SyncManager` ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ë³´ë‚¸ ì´ë²¤íŠ¸ë¼ëŠ” ê²ƒì„ ê°ì§€í•˜ê³  í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í• ìˆ˜ ìˆë‹¤.

```js
self.addEventListener("sync", (event) => {
	if (event.tag === "add-reservation") {
		event.waitUntil(
			addReservation()
			.then(() => {
				return Promise.resolve()
			})
			.catch((error) => {
				if (event.lastChance) {
					return removeReservation();
				} else {
					return Promise.reject();
				}
			})
		);
	}
});
```





