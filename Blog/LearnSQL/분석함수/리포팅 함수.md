
>[!info] 순위 생성과 더불어 분석 함수의 또 다른 일반적인 용도는 최솟값 또는 최댓값 등의 특잇값을 찾거나 전체 데이터셋에서 합꼐 또는 평균을 생성하는 것이다.

이러한 특이값을 찾을수 있도록 제공해주는 함수는 다음과 같다.

- **MIN()**
- **MAX()**
- **AVG()**
- **SUM()**
- **COUNT()**

다음은 지불 금액이 10 달러 이상인 모든 행에 대해 월별 및 전체 총계를 생성한다.

```mysql
SELECT
	MONTHNAME(payment_date) mn,
	amount,
	SUM(amount) OVER (
		PARTITION BY MONTHNAME(payment_date)
	) tot_mn_amount,
	SUM(amount) OVER () tot_amount
FROM payment p
WHERE amount > 10;
```

```sh
mn    |amount|tot_mn_amount|tot_amount|
------+------+-------------+----------+
August| 10.99|       521.53|   1262.86|
August| 10.99|       521.53|   1262.86|
August| 11.99|       521.53|   1262.86|
August| 10.99|       521.53|   1262.86|
August| 11.99|       521.53|   1262.86|
August| 10.99|       521.53|   1262.86|
...
```

`tot_amount` 는 `OVER ()` 이므로, 전체 행을 대상으로 `amount` 를 합산한다.
다음은 매월 총 지급액을 계산한 다음, 매월 총 지급액의 백분율을 계산한다.

```mysql
SELECT
	MONTHNAME(payment_date) payment_month,
	SUM(amount) month_tot,
	ROUND(SUM(amount) / SUM(SUM(amount)) OVER () * 100, 2) pct_of_total
FROM payment p
GROUP BY MONTHNAME(payment_date);
```

```sh
payment_month|month_tot|pct_of_total|
-------------+---------+------------+
May          |  4823.44|        7.16|
June         |  9629.89|       14.29|
July         | 28368.91|       42.09|
August       | 24070.14|       35.71|
February     |   514.18|        0.76|
```

리포팅 함수는 다음 쿼리에서와 같은 비교 용도로 쓸 수 있다.

이 쿼리는 월 총계가 최대, 최소 또는 중간에 있는지 여부를 판별하기 위해 `case` 표현식을 사용한다.

```mysql
SELECT
	MONTHNAME(payment_date) payment_month,
	SUM(amount) month_tot,
	CASE SUM(amount)
		WHEN MAX(SUM(amount)) OVER () THEN 'Highest'
		WHEN MIN(SUM(amount)) OVER () THEN 'Lowest'
		ELSE 'Middle'
	END descriptor
FROM payment p
GROUP BY MONTHNAME(payment_date)
```

```sh
payment_month|month_tot|descriptor|
-------------+---------+----------+
May          |  4823.44|Middle    |
June         |  9629.89|Middle    |
July         | 28368.91|Highest   |
August       | 24070.14|Middle    |
February     |   514.18|Lowest    |
```

`descriptor` 열은 상한값과 하한값을 식별하는데 도움이 된다.
이러한 점에서 `rank` 함수의 역할을 한다고 볼 수 있다.
