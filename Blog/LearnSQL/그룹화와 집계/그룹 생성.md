
> [!info] 데이터를 분선하는 사람들은 요구사항에 더 잘 맞도록 원시 데이터를 조작하기를 원한다<br>일반적인 조작 사례는 다음과 같다

- **전체 유럽 판매량 등 특정 지역에 대한 총계 생성**
- **2020 년 최고 영업사원 등의 특정 값 찾기**
- **매월 대여한 영화 수 등의 빈도 계산**

이러한 쿼리에 답하려면 하나 이상의 열 또는 포현식으로 행을 그룹화 하도록 데이터베이스 서버에 요청해야 한다.

## 단일 열 그룹화

단일 열 그룹은 가장 단순하고 자주 사용되는 그룹유형이다

```mysql
SELECT 
	actor_id,
	count(*)
FROM film_actor
GROUP BY actor_id;
```

```sh
actor_id|count(*)|
--------+--------+
       1|      19|
       2|      25|
       3|      22|
       4|      22|
       5|      29|
       6|      20|
       7|      30|
       8|      20|
       9|      25|
      10|      22|
      11|      25|
...
```

이는 `200` 개의 `actor_id` 를 그룹화한 데이터셋이다.

### 다중 열 그룹화

이는 여러개의 열을 그룹화 하는 그룹유형이다
다음은, 각 배우의 영화 등급에 대한 총 영화 수를 찾는다.

```mysql
SELECT
	fa.actor_id,
	f.rating,
	count(*)
FROM film_actor fa
	INNER JOIN film f
	ON fa.film_id = f.film_id
GROUP BY fa.actor_id, f.rating
ORDER BY 1, 2;
```

```sh
actor_id|rating|count(*)|
--------+------+--------+
       1|G     |       4|
       1|PG    |       6|
       1|PG-13 |       1|
       1|R     |       3|
       1|NC-17 |       5|
       2|G     |       7|
...
```

### 그룹화와 표현식

열을 사용해서 데이터를 그룹화 하는 것 외에도, 표현식으로 생성한 값 기반으로 그룹을 만들수 있다

```mysql
SELECT 
	EXTRACT(YEAR FROM retnal_date) year,
	COUNT(*) how_many
FROM rental
GROUP BY EXTRACT(YEAR FROM rental_date);
```

```sh
year|how_many|
----+--------+
2005|   15862|
2006|     182|
```

이는 `EXTRACT` 함수를 사용한 표현식으로 `GROUP` 화한 예시이다.

### 롤업 생성

만약, 배우/등급 조합과 더불어 각 개별 배우의 총합도 원한다고 가정하자
이때 사용하는 것이 `WITH ROLLUP` 이다.

```mysql
SELECT 
	fa.actor_id,
	f.rating,
	COUNT(*)
FROM film_actor fa
	INNER JOIN film f
	ON fa.film_id = f.film_id
GROUP BY fa.actor_id, f.rating WITH ROLLUP
ORDER BY 1, 2;
```

```sh
actor_id|rating|COUNT(*)|
--------+------+--------+
    NULL|  NULL|    5462|
       1|  NULL|      19|
       1|G     |       4|
       1|NC-17 |       5|
       1|PG    |       6|
       1|PG-13 |       1|
       1|R     |       3|
       2|  NULL|      25|
       2|G     |       7|
       2|NC-17 |       8|
       2|PG    |       6|
       2|PG-13 |       2|
       2|R     |       2|
       3|  NULL|      22|
       3|G     |       2|
       3|NC-17 |       5|
       3|PG    |       5|
       3|PG-13 |       5|
       3|R     |       5|
...
```

`NULL` 부분을 보면 각 그룹 지어진 `COUNT` 값의 총합계가 계산된다.
가장 윗부분은 `5462` 개인것을 볼 수 있는데, 이는 `film_actor` 쿼리된 행의 수와 같다




