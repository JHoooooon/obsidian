
---

>[!info] 본 공부는 Learning SQL 을 보고 내용을 정리한것이다


현재 날짜와 시간을 리턴하는 MYSQL 함수이다.

```sql
SELECT now();

SELECT now() FROM dual;
```

> [!info] from 절이 없는이유
> 하나의 테이블을 지정하는 from 절이 없으면 쿼리를 실행할수 없다. 하지만 MySQL 은 from 절 없이 select 절만 사용가능하다
> 
> MySQL 은 Oracle 과의 하위호환성을 위해 FROM dual; 테이블을 제공한다.

## MySQL 자료형

>[!info] JSON 및 공간 데이터형 같은 특수 자료형은 다루지 않고 이후 챕터에서 다룬다고 한다

### 문자 데이터

>[!info] [[문자열 데이터 처리]] 에서 내장 함수를 사용을 볼수 있다. 

문자 데이터는 고정 길이또는 가변 길이 문자열로 저장될수 있다

**고정 길이 문자열은 공백으로 오른쪽이 채워지고 항상 동일한 수의 바이트를 사용**하는데 비해, **가변 길이 문자열은 공백으로 오른쪽이 채워지지 않고 항상 동일한 수의 바이트를 사용하지 않는다**는 차이점이 있다

```sql
char(20) # fixed-length
varchar(20) # variabel-length
```

| 자료형     | 최대길이(byte) |
| :------ | :--------- |
| char    | 255        |
| varchar | 65535      |
이후 나머지 문자에 대해서 알려준다.

### 캐릭터셋

영어와 같이 라틴 알파벳을 사용하는 언어는 각 문자 character 를 저장하는 데 단 1 byte 만 필요할 정도로 문자수가 적다.

반면 한국어를 비롯한 다른 언어들은 많은 수의 문자를 표함하므로 각 문자마다 여러 바이트의 저장 공간이 필요하다

이러한 **문자 집합을 캐릭터셋이라 부르며, 여러 바이트의 저장 공간이 필요한 캐리터셋을 멀티 캐릭터셋**이라한다

```sql
SHOW CHARACTER SET;

Charset |Description                    |Default collation  |Maxlen|
--------+-------------------------------+-------------------+------+
armscii8|ARMSCII-8 Armenian             |armscii8_general_ci|     1|
ascii   |US ASCII                       |ascii_general_ci   |     1|
big5    |Big5 Traditional Chinese       |big5_chinese_ci    |     2|
binary  |Binary pseudo charset          |binary             |     1|
cp1250  |Windows Central European       |cp1250_general_ci  |     1|
cp1251  |Windows Cyrillic               |cp1251_general_ci  |     1|
cp1256  |Windows Arabic                 |cp1256_general_ci  |     1|
cp1257  |Windows Baltic                 |cp1257_general_ci  |     1|
cp850   |DOS West European              |cp850_general_ci   |     1|
cp852   |DOS Central European           |cp852_general_ci   |     1|
cp866   |DOS Russian                    |cp866_general_ci   |     1|
cp932   |SJIS for Windows Japanese      |cp932_japanese_ci  |     2|
dec8    |DEC West European              |dec8_swedish_ci    |     1|
eucjpms |UJIS for Windows Japanese      |eucjpms_japanese_ci|     3|
euckr   |EUC-KR Korean                  |euckr_korean_ci    |     2|
gb18030 |China National Standard GB18030|gb18030_chinese_ci |     4|
gb2312  |GB2312 Simplified Chinese      |gb2312_chinese_ci  |     2|
gbk     |GBK Simplified Chinese         |gbk_chinese_ci     |     2|
geostd8 |GEOSTD8 Georgian               |geostd8_general_ci |     1|
greek   |ISO 8859-7 Greek               |greek_general_ci   |     1|
hebrew  |ISO 8859-8 Hebrew              |hebrew_general_ci  |     1|
hp8     |HP West European               |hp8_english_ci     |     1|
keybcs2 |DOS Kamenicky Czech-Slovak     |keybcs2_general_ci |     1|
koi8r   |KOI8-R Relcom Russian          |koi8r_general_ci   |     1|
koi8u   |KOI8-U Ukrainian               |koi8u_general_ci   |     1|
latin1  |cp1252 West European           |latin1_swedish_ci  |     1|
latin2  |ISO 8859-2 Central European    |latin2_general_ci  |     1|
latin5  |ISO 8859-9 Turkish             |latin5_turkish_ci  |     1|
latin7  |ISO 8859-13 Baltic             |latin7_general_ci  |     1|
macce   |Mac Central European           |macce_general_ci   |     1|
macroman|Mac West European              |macroman_general_ci|     1|
sjis    |Shift-JIS Japanese             |sjis_japanese_ci   |     2|
swe7    |7bit Swedish                   |swe7_swedish_ci    |     1|
tis620  |TIS620 Thai                    |tis620_thai_ci     |     1|
ucs2    |UCS-2 Unicode                  |ucs2_general_ci    |     2|
ujis    |EUC-JP Japanese                |ujis_japanese_ci   |     3|
utf16   |UTF-16 Unicode                 |utf16_general_ci   |     4|
utf16le |UTF-16LE Unicode               |utf16le_general_ci |     4|
utf32   |UTF-32 Unicode                 |utf32_general_ci   |     4|
utf8mb3 |UTF-8 Unicode                  |utf8mb3_general_ci |     3|
utf8mb4 |UTF-8 Unicode                  |utf8mb4_0900_ai_ci |     4|
```

`maxlen` 의 값이 `1` 보다 크면 멀티바이트 캐릭터셋이라는 의미이다.

>[!info] MySQL 8 버전 부터는 기본 캐릭터셋이 utf8mb4 로 설정된다.

만약 지원하는 캐릭터셋중 하나를 선택한다면 다음처럼 자료형 정의 뒤에 지원되는 캐릭터셋 중 하나를 지정할수 있다.

```mysql
VARCHAR(20) CHARACTER SET latin1;
```

혹은, 데이터베이스에 대한 기본 캐릭터셋을 설정하려면 다음처럼 한다

```mysql
CREATE DATABASE test_db CHARACTER SET latin1;
```

### 텍스트 데이터

>[!info] [[문자열 데이터 처리]] 에서 내장 함수를 사용을 볼수 있다. 

`varchar` 는 `64KB` 제한을 초과하는 데이터를 저장하지 못한다.
이러한 데이터를 저장하려면 텍스트 자료형을 사용해야 한다

| 자료형        | 최대 바이트 크기     |
| :--------- | :------------ |
| tinytext   | 255           |
| text       | 65,535        |
| mediumtext | 16,777,215    |
| longtext   | 4,294,967,295 |
텍스트 데이터의 몇가지 주의사항을 고려해야할 필요가 있다

-  텍스트열에 로드되는 데이터가 해당 유형의 크기를 초과하면 데이터가 잘린다.
- 데이터를 열에 로드하면 후행 공백이 제거되지 않는다
- 정렬 또는 그룹화에 `text` 열을 사용할 경우, 필요하다면 한도를 늘릴수 있지만 처음에는 1,024 바이트만 사용된다.
- `text` 를 제외한 텍스트 자료형은 `MySQL` 의 고유한 자료형이다.
- MySQL 은 `varchar` 열에  최대 65,535 바이트를 허용하므로, `tinytext` 나 `text` 자료형을 사용할 필요가 없어졌다

>[!info] 버전 4 에서는 varchar 의 바이트가 255 로 제한되었다고 한다.

[[문자열 데이터 처리]]] 에서 이에대한, 함수들을 볼수 있다.

### 숫자 데이터

>[!info] [[숫자 데이터 처리]] 에서 내장 함수및 더 자세한 개념을 볼수 있다. 

숫자 데이터는 단일 숫자 자료형을 갖는게 합리적으로 보일수 있다.
실제로 다음과 같이 숫자가 쓰이는 다양한 방식을 반영하는  몇가지 숫자 자료형이 있다.

- BOOLEAN
- AUTO_INCREMENT 
- NUMERIC

기본 숫자 자료형은 다음과 같다

| 자료형       | 부호있는 정수 (signed)               | 부호없는 정수 (unsigned) |
| :-------- | :----------------------------- | :----------------- |
| tinyint   | -128 ~ 127                     | 0 ~ 255            |
| smallint  | -32,768 ~ 32,767               | 0 ~ 65,535         |
| mediumint | -8,388,608 ~ 8,388,607         | 0 ~ 16,777,215     |
| int       | -2,147,483,648 ~ 2,147,483,647 | 0 ~ 4,294,967,295  |
| bigint    | -2^63 ~ 2^63                   | 0 ~ 2^64 - 1       |
이외에 부동소수점 자료형이 존재한다.

| 자료형          | 숫자범위 (signed)                                       | 숫자범위(unsigned)                    |
| :----------- | :-------------------------------------------------- | :-------------------------------- |
| float(p, s)  | -3,402823466E+38 ~ 1.175494351E-38                  | 1.175494351E-38 ~ 3.402823466E-38 |
| double(p, s) | -1.7976931348623157E+308 ~ -2.2250738585072014E-308 | 2.2250738585072014E-308 ~ 1.7976931348623157E+308        |

여기서 `p` 는 `precision` 의 약자로 `정밀도` 를 말하며, `s` 는 `scale` 인 `척도` 를 말한다

>[!info] `정밀도` 는 소수점 왼쪽과 오른쪽 모두에 허용되는 자릿수

>[!info] `척도` 는 소수점 오른쪽의 허용 자릿수

정밀도와 척도를 사용한 예는 다음과 같다

```mysql
float(4,2) # 전체자리수는 4자리, 그중 소수점 오른쪽은 2자리
			# 27.44 or 17.87
```

### 시간 데이터(Temporal Data)

>[!info] [[시간 데이터 처리]] 에서 내장 함수를 사용을 볼수 있다. 

문자열 및 숫자와 함께 날자나 시간 관련 정보를 활용할수 있다.

| 자료형       | 기본 형식               | 허용값                                                     |
| :-------- | ------------------- | ------------------------------------------------------- |
| date      | YYYY-MM-DD          | 1000-01-01 ~ 9999-12-31                                 |
| datetime  | YYYY-MM-DD HH:MM:SS | 1000-01-01 00:00:00:000000 ~ 2038-01-18 22:14:07:999999 |
| timestamp | YYYY-MM-DD HH:MM:SS | 1000-01-01 00:00:00:000000 ~ 2038-01-18 22:14:07:999999 |
| year      | YYYY                | 1901 ~ 2155                                             |
| time      | HHH:MI:SS           | -838:59:59 000000 ~ 838:59:59 000000                    |
`datetime`, `timestamp`, `time` 자료형은 소수점 이하 6자리(Micro Seconds) 까지 사용할수 있다.

>[!info] 이러한 자료형중 하나로 열을 정의할때 0 ~ 6 사이의 값을 제공할수 있다고 한다. datetime(2)  는 시간 값이 1/100 초를 포함할수 있다고 한다.

다음은 날짜 형식의 구성요소들이다

| 요소   | 정의        | 범위              |
| :--- | :-------- | :-------------- |
| YYYY | 연도, 세기 포함 | 1000 ~ 9999     |
| MM   | 월         | 01(월) ~ 12(12월) |
| DD   | 일         | 01 ~ 31         |
| HH   | 시간        | 00 ~ 23         |
| HHH  | 시간(경과)    | -838 ~ 838      |
| MI   | 분         | 00 ~ 59         |
| SS   | 초         | 00 ~ 59         |

```mysql
update person
	set birth_date = str_to_date('DEC-21-1980', '%b-%d-%Y')
where person_id = 1;
```

>[!note]
> `MYSQL` 에서는 `%Y` 를 사용해서 4글자 연도를 나타낼수도 있다.
> 다음은 `datetime` 으로 변환할때 필요한 몇가지 추가 포맷이다
 >>
 >- `%a`:  The short weekday name, such as Sun, Mon, ...
 >- `%b`: The short month name, such as Jan, Feb ...
 >- `%c`: The numeric month (0...12)
 >- `%d`: The numeric of day of the month (00...31)
 >- `%f`: The number of microseconds (000000...999999)
 >- `%H`: The hour of the day, in 24-hour format (00..23)
 >- `%h`: The hour of the day, in 12-hour format (01..12)
 >- `%i`: The minutes within the hour (00..59)
 >- `%j`: The day of year (001..366)
 >- `%M`: The full month name (January..December)
 >- `%m`: The numeric month
  >- `%p`: AM or PM
  >- `%s`: The number of seconds (00..59)
  >- `%W`: The full weekday name (Sunday..Saturday)
  >- `%w`: The numeric day of the week (0=Sunday..6=Saturday)
> - `%Y`: The four-digit year
 

